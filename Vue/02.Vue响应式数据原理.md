# Vue 响应式数据原理

## Vue2.x 响应式数据原理

在组件初始化时，通过 `Object.defineProperty` 方法给 `data` 选项中的所有属性加上 `getter/setter`，`getter` 用来依赖收集，`setter` 用来派发更新。

在调用 `render` 方法生成虚拟 DOM 的时候，会用到 `data` 的属性值，此时会触发 `getter` 函数, 将当前的观察者 `watcher` 注册进 `subs` 里，完成依赖收集的订阅。

当 `data` 属性发生变化后，会触发 `setter`函数，然后遍历依赖收集过程中订阅的的所有观察者，也就是 `subs` 里所有的 `watcher` 对象，通知他们去重新渲染组件。

![响应式数据原理](../img/响应式数据原理.png)

## Vue3.x 响应式数据原理

Vue3.x 改用代理 `Proxy` 替代 `Object.defineProperty` 方法实现数据劫持。

`Object.defineProperty` 方法只能监听对象已存在的属性，不能监听属性的新增和删除，所以要通过 `Vue.set()` 和 `Vue.delete()` 来实现。

`Object.defineProperty` 方法也不能监听数组的变化，只能通过重写数组的那 7 个方法进行监听。

`Proxy` 是对整个目标对象进行代理，返回一个新的对象，可以监听属性的新增和删除，也能监听数组下标和数组长度的变化。
